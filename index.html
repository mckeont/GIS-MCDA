<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WRF BMP Decision Tool for Wet Weather Management </title>
    <h4> *Input GIS-MCDA data as CSV file* </h4>
    The GIS-MCDA model serves to inform the development of a user-centric web application, designed to facilitate intuitive interaction. This tool uses JavaScript, CSS, HTML, and PHP to build a user interface available both as a standalone website and as an integrated component for ESRI Storymaps. 

The application prompts users to input geographic layers—shapefiles, CSVs, GeoJSON, KML, etc.—pertaining to environmental, social, economic, and regulatory criteria, bundled as a compressed zipped file. Subsequently, users categorize each layer into their chosen triple bottom line categories using dropdown menus and text boxes. 

To initiate the analysis, users define their geographic area of interest (utility service region), thereby setting boundaries for analysis The map interface, empowered by the Leaflet library, showcases the service areas alongside relevant geographic data. This interactive map allows seamless navigation, zooming, and manipulation. 

JavaScript, integrated with the Leaflet library, handles the incorporated GIS data layers reflecting environmental impact, social factors, regulatory adherence, economic feasibility, and other pertinent parameters. It's responsible for processing user-defined criteria on the client-side, dynamically adjusting weights and parameters based on these inputs. For more intricate calculations or extensive data processing, the backend, implemented in PHP or another backend language, handles the heavier computations. 

The application executes the Multi-Criteria Decision Analysis (MCDA) algorithm, considering weighted factors and spatial relationships. This process may involve a blend of client-side (JavaScript) and server-side (PHP or backend script) processing. Outputs consist of visualization of analysis results integrated onto the study extent on the map, highlighting recommended Best Management Practices (BMPs) across various locations. Users interact with the map's elements, gaining insights by clicking on specific areas to access detailed information about recommended strategies, their benefits, and implementation guidelines. This tool provides a dynamic and responsive environment where stakeholders can actively engage in the decision-making process for wet weather management, supported by GIS-MCDA methodologies. 
    <style>
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      input[type="file"] {
        margin-top: 20px;
      }

      button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: lightblue;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      select {
        margin-top: 20px;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      table {
        margin-top: 20px;
        border-collapse: collapse;
        width: 100%;
      }

      th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
      }

      .image-cell {
        max-width: 300px;
        max-height: 300px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Wet Weather Management Mapper</h1>
      <input type="file" id="fileInput" accept=".csv">
      <div id="imageContainer"></div>
      <select id="columnSelect"></select>
      <button id="correctButton">Run GIS-MCDA Model</button>
      <table id="csv-table">
        <thead>
          <tr>
            <th>Layer Information</th>
            <th>Weighing (Numeric Input)</th>
            <th>Evaluation Score (1-100)</th>
          </tr>
        </thead>
        <tbody id="csv-data"></tbody>
      </table>
    </div>
    <script>
      let rows;

      const fileInput = document.querySelector("#fileInput");
      const columnSelect = document.querySelector("#columnSelect");
      const correctButton = document.querySelector("#correctButton");
      const csvData = document.querySelector("#csv-data");

      function handleFileSelect(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.readAsText(file);
        reader.onload = function (event) {
          const csv = event.target.result;
          rows = csv.split("\n");
          const headers = rows[0].split(",");

          // Populate the column select dropdown with the column names
          for (let i = 0; i < headers.length; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.text = headers[i];
            columnSelect.appendChild(option);
          }
        };
      }

      function handleCorrectButtonClick(event) {
        const selectedColumnIndex = columnSelect.value;
        const headers = rows[0].split(",");
        csvData.innerHTML = "";
        const imageContainer = document.getElementById("imageContainer");
        imageContainer.innerHTML = ""; // Clear any existing content

        // Add the image outside the loop
        const imageTd = document.createElement("td");
        const image = document.createElement("img");
        image.src = 'https://journal.uir.ac.id/public/journals/11/article_10878_cover_en_US.png';
        image.classList.add("image-cell");
        imageTd.appendChild(image);
        imageContainer.appendChild(imageTd);

        for (let i = 1; i < rows.length; i++) {
          const cells = rows[i].split(",");
          if (cells.length >= headers.length) {
            const zip = cells[selectedColumnIndex].trim();
            const correctedZip = zip.padStart(5, "0");
            const randomNumber = Math.floor(Math.random() * 100) + 1; // Generate random number between 1 and 100

            const tr = document.createElement("tr");
            const originalZipTd = document.createElement("td");
            originalZipTd.textContent = zip;
            tr.appendChild(originalZipTd);
            const correctedZipTd = document.createElement("td");
            correctedZipTd.textContent = correctedZip;
            tr.appendChild(correctedZipTd);

            // Add the random number column
            const randomNumTd = document.createElement("td");
            randomNumTd.textContent = randomNumber;
            tr.appendChild(randomNumTd);

            csvData.appendChild(tr);
          }
        }
      }

      fileInput.addEventListener("change", handleFileSelect);
      correctButton.addEventListener("click", handleCorrectButtonClick);
    </script>
  </body>
</html>
